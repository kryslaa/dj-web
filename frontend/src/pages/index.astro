---
import { getSettings, getAbout, getAllVideos, getHero, getSocialLinks } from '../lib/api';
import '../styles/fonts/fonts.css';
import RichText from '../components/RichText.jsx';

const settings = await getSettings();
const about = await getAbout();
const hero = await getHero();
const socialLinks = await getSocialLinks();
const channelId = settings?.youtubeChannelId;
const videos = channelId ? await getAllVideos(channelId, 4) : [];
const STRAPI_URL = import.meta.env.PUBLIC_STRAPI_URL || 'http://127.0.0.1:1337';

// Helper function to get icon SVG
function getIconSVG(iconName: string) {
  const icons: Record<string, string> = {
    instagram: `<path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>`,
    youtube: `<path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>`,
    email: `<path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>`,
    tiktok: `<path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>`,
    soundcloud: `<path d="M7 17.939h-1v-8.068c.308-.231.639-.429 1-.566v8.634zm3 0h1v-9.224c-.229.265-.443.548-.621.857l-.379-.184v8.551zm-2 0h1v-8.848c-.508-.079-.623.051-1 .169v8.679zm-4 0h1v-6.778c-.553.256-1 .587-1 1.051v5.727zm-3 0h1v-5.139c-.695.299-1 .711-1 1.156v3.983zm15 0h1v-9.664c-.191.204-.383.405-.577.606.035.021.068.044.102.066l-.525-.228v9.22zm-6 0h1v-10.933c-.414-.29-.845-.538-1-.596v11.529zm-4 0h1v-7.94c-.438-.255-.595-.231-1 0v7.94zm1-10.516v-.1c-.199-.07-.388-.1-.569-.19-.063-.124-.095-.254-.138-.396h-2.293c.027.367.106.713.239 1.037.218.106.44.207.661.313v-.664zm-1.219 7.056l.016-.047c-.176-.25-.35-.5-.528-.75l-.015.019v.778zm2.219-.19v.134c.215.099.432.2.648.301v-.435l-.648-.264v.264zm-2 .43v.045c.085.003.168.006.25.009.09-.02.17-.03.26-.04h-.51v-.014zm-11-2.027c0-1.679 1.421-3.023 3.174-3.023.689 0 1.355.186 1.948.54.158-.057.325-.109.49-.144.173-.037.356-.063.552-.063l.116-.006v-1.254c0-.042-.002-.084-.005-.126-.049-.004-.097-.007-.147-.007-1.156 0-2.227.4-3.063 1.071C4.03 7.438 3 9.006 3 10.775c0 .485.073.966.221 1.432.014.043.029.084.043.127l.97-.247c-.011-.031-.02-.064-.03-.095-.114-.368-.171-.746-.171-1.127zm15.995 4.057c.002-.067.005-.133.005-.2v-10.926c0-.102-.01-.202-.023-.302-1.002-.446-2.096-.758-3.186-.947-.029-.006-.057-.009-.085-.015-.279-.052-.565-.085-.857-.111-.076-.007-.151-.018-.227-.023-.306-.023-.614-.035-.925-.035-5.511 0-10 4.489-10 10v.024c.148.018.295.035.442.051.044.005.088.013.132.019.254.028.508.059.761.098.024.004.047.011.071.015.263.043.525.094.786.154l.048.011c.246.058.491.121.734.195.028.008.056.019.084.027.282.089.562.186.84.297.012.005.024.008.036.013.265.107.527.223.786.347.013.006.026.01.039.017.228.11.452.23.674.356l.099.058c.303.178.601.368.894.57l.012.008c.293.203.58.417.861.64l.028.022c.271.217.535.444.792.679l.038.035c.256.236.504.48.745.731.011.012.021.022.032.034.244.255.479.518.708.787.009.01.019.022.028.032.226.267.444.541.654.822.012.015.023.029.035.044.197.265.383.537.562.814.012.018.023.036.035.054.181.283.352.573.515.867.009.017.018.034.027.051.158.288.306.581.446.878.014.03.027.059.04.089.129.279.248.562.36.849.018.048.035.097.053.145.103.273.198.549.285.828.013.042.025.085.038.127.083.277.157.557.223.84.011.048.022.097.033.145.061.273.114.549.16.827.007.043.014.086.021.129.044.282.081.565.11.851.004.036.008.073.012.109.027.294.046.589.057.887.001.024.003.049.004.073.007.285.009.571.004.859l-.001.052c-.004.134-.01.268-.019.401l-.003.051c-.01.142-.023.283-.038.424l-.004.037c-.015.131-.033.262-.054.392l-.008.046c-.021.13-.044.259-.07.388-.006.03-.011.06-.017.09-.027.13-.058.259-.09.388-.01.04-.019.08-.029.12-.033.128-.069.256-.107.383-.013.043-.026.086-.039.129-.04.125-.082.249-.126.373-.017.047-.033.095-.05.142-.046.125-.095.249-.145.373-.021.053-.042.107-.064.16-.053.124-.108.247-.165.37-.026.056-.052.112-.079.167-.059.119-.12.237-.182.355-.031.059-.062.118-.094.177-.067.121-.136.241-.206.361-.036.061-.071.122-.108.183-.074.119-.15.237-.227.355-.042.063-.083.126-.126.189-.081.116-.164.231-.248.346-.048.066-.096.132-.145.197-.088.113-.177.225-.268.336-.055.067-.109.134-.165.201-.095.108-.192.215-.29.321-.062.067-.123.134-.186.201-.101.105-.204.209-.308.313-.07.07-.139.14-.21.209-.106.102-.214.203-.323.303-.078.072-.155.144-.234.215-.112.098-.226.194-.34.29-.086.072-.171.144-.258.215-.118.094-.238.187-.358.279-.094.072-.187.143-.282.213-.124.09-.249.179-.375.267-.102.071-.203.142-.306.211-.131.088-.264.174-.397.259-.11.071-.22.141-.331.21-.138.084-.277.167-.417.249-.118.068-.236.136-.355.203-.144.08-.289.159-.435.237-.125.067-.25.133-.376.198-.15.077-.302.152-.455.226-.132.064-.264.128-.397.19-.157.072-.315.143-.474.213-.139.061-.278.122-.418.181-.164.068-.329.134-.495.199-.146.058-.292.115-.439.171-.171.063-.343.125-.516.185-.153.054-.306.107-.46.159-.177.059-.355.116-.534.172-.161.051-.322.101-.484.15-.184.054-.369.107-.555.158-.169.047-.338.093-.508.138-.19.05-.381.098-.573.145-.177.044-.354.087-.532.128-.196.045-.392.088-.589.13-.185.039-.37.077-.556.114-.201.04-.403.079-.606.116-.193.036-.386.07-.58.103-.206.035-.412.068-.619.099-.2.03-.4.059-.601.087-.211.029-.423.056-.636.082-.207.025-.414.049-.622.071-.216.023-.432.044-.649.064-.214.019-.428.037-.643.054-.22.017-.44.032-.66.047-.221.015-.442.028-.664.04-.225.012-.45.023-.676.032-.228.01-.456.018-.684.025-.231.007-.462.013-.694.018-.237.004-.474.007-.711.009-.243.002-.487.003-.73.003l-.015-.002c-.252 0-.503-.001-.754-.003l-.015.002c-.238 0-.475-.002-.712-.009-.232-.005-.464-.011-.695-.018-.228-.007-.456-.015-.684-.025-.222-.012-.443-.025-.664-.04-.22-.015-.44-.03-.66-.047-.215-.017-.429-.035-.643-.054-.217-.02-.433-.041-.649-.064-.208-.022-.415-.046-.622-.071-.213-.026-.425-.053-.636-.082-.201-.028-.401-.057-.601-.087-.207-.031-.413-.064-.619-.099-.194-.033-.387-.067-.58-.103-.203-.037-.405-.076-.606-.116-.186-.037-.371-.075-.556-.114-.197-.042-.393-.085-.589-.13-.178-.041-.355-.084-.532-.128-.192-.047-.383-.095-.573-.145-.17-.045-.339-.091-.508-.138-.186-.051-.371-.104-.555-.158-.162-.049-.323-.099-.484-.15-.179-.056-.357-.113-.534-.172-.154-.052-.307-.105-.46-.159-.173-.06-.345-.122-.516-.185-.147-.056-.293-.113-.439-.171-.166-.065-.331-.131-.495-.199-.14-.059-.279-.12-.418-.181-.159-.07-.317-.141-.474-.213-.133-.062-.265-.126-.397-.19-.153-.074-.305-.149-.455-.226-.126-.065-.251-.131-.376-.198-.146-.078-.291-.157-.435-.237-.119-.067-.237-.135-.355-.203-.14-.082-.279-.165-.417-.249-.111-.069-.221-.139-.331-.21-.133-.085-.266-.171-.397-.259-.103-.069-.204-.14-.306-.211-.126-.088-.251-.177-.375-.267-.095-.07-.188-.141-.282-.213-.12-.092-.24-.185-.358-.279-.087-.071-.172-.143-.258-.215-.114-.096-.228-.192-.34-.29-.079-.071-.156-.143-.234-.215-.109-.1-.217-.201-.323-.303-.071-.069-.14-.139-.21-.209-.104-.104-.207-.208-.308-.313-.063-.067-.124-.134-.186-.201-.098-.106-.195-.213-.29-.321-.056-.067-.11-.134-.165-.201-.091-.111-.18-.223-.268-.336-.049-.065-.097-.131-.145-.197-.084-.115-.167-.23-.248-.346-.043-.063-.084-.126-.126-.189-.077-.118-.153-.236-.227-.355-.037-.061-.072-.122-.108-.183-.07-.12-.139-.24-.206-.361-.032-.059-.063-.118-.094-.177-.062-.118-.123-.236-.182-.355-.027-.055-.053-.111-.079-.167-.057-.123-.112-.246-.165-.37-.022-.053-.043-.107-.064-.16-.05-.124-.099-.248-.145-.373-.017-.047-.033-.095-.05-.142-.044-.124-.086-.248-.126-.373-.013-.043-.026-.086-.039-.129-.038-.127-.074-.255-.107-.383-.01-.04-.019-.08-.029-.12-.032-.129-.063-.258-.09-.388-.006-.03-.011-.06-.017-.09-.026-.129-.049-.258-.07-.388l-.008-.046c-.021-.13-.039-.261-.054-.392l-.004-.037a49.47 49.47 0 0 1-.038-.424l-.003-.051a59.53 59.53 0 0 1-.019-.401l-.001-.052c-.005-.288-.003-.574.004-.859.001-.024.003-.049.004-.073.011-.298.03-.593.057-.887.004-.036.008-.073.012-.109.029-.286.066-.569.11-.851.007-.043.014-.086.021-.129.046-.278.099-.554.16-.827.011-.048.022-.097.033-.145.066-.283.14-.563.223-.84.013-.042.025-.085.038-.127.087-.279.182-.555.285-.828.018-.048.035-.097.053-.145.112-.287.231-.57.36-.849.013-.03.026-.059.04-.089.14-.297.288-.59.446-.878.009-.017.018-.034.027-.051.163-.294.334-.584.515-.867.012-.018.023-.036.035-.054.179-.277.365-.549.562-.814.012-.015.023-.029.035-.044.21-.281.428-.555.654-.822.009-.01.019-.022.028-.032.229-.269.464-.532.708-.787.011-.012.021-.022.032-.034.241-.251.489-.495.745-.731.013-.013.025-.026.038-.035.257-.235.521-.462.792-.679.009-.008.019-.015.028-.022.281-.223.568-.437.861-.64l.012-.008c.293-.202.591-.392.894-.57l.099-.058c.222-.126.446-.246.674-.356.013-.007.026-.011.039-.017.259-.124.521-.24.786-.347.012-.005.024-.008.036-.013.278-.111.558-.208.84-.297.028-.008.056-.019.084-.027.243-.074.488-.137.734-.195l.048-.011c.261-.06.523-.111.786-.154.024-.004.047-.011.071-.015.253-.039.507-.07.761-.098.044-.006.088-.014.132-.019.147-.016.294-.033.442-.051z"/>`,
  };
  return icons[iconName] || icons.instagram;
}
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{settings?.siteName || 'Krysla'}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  </head>
  <body class="bg-[#E5A2C3] min-h-screen font-sans">
    <!-- Fixed Navbar with Logo -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-[#D77FA1] shadow-lg">
      <div class="container mx-auto px-6 py-4 flex justify-center">
        {settings?.logo && (
          <a href="/" class="transition-transform hover:scale-105">
            <img 
              src={`${strapiUrl}${settings.logo.url}`}
              alt={settings?.siteName || 'Logo'}
              class="h-14 w-auto"
            />
          </a>
        )}
      </div>
    </nav>

    <!-- Spacer for fixed navbar -->
    <div class="h-24"></div>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8 max-w-6xl">
      
      <!-- Hero Section with Background Image -->
      <section class="text-center mb-16 relative">
        {hero?.heroImage && (
          <div class="relative">
            <img 
              src={`${strapiUrl}${hero.heroImage.url}`}
              alt="Hero"
              class="w-full max-w-4xl mx-auto rounded-3xl"
            />
          </div>
        )}
        
        <h2 class="text-2xl md:text-3xl font-bold text-[#2B1F3D] mt-6">
          {hero?.heroText || 'do you like to dance?'}
        </h2>
      </section>

      <!-- Videos Grid -->
      {videos.length > 0 && (
        <section class="mb-16">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {videos.map((video) => (
              <div class="group h-full">
                <!-- Video Card -->
                <div class="bg-[#E8E35C] rounded-3xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:scale-[1.02] h-full flex flex-col">
                  <!-- Thumbnail -->
                  <figure class="relative aspect-video overflow-hidden bg-black cursor-pointer flex-shrink-0">
                    <a 
                      href={`https://www.youtube.com/watch?v=${video.id}`}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="block w-full h-full"
                    >
                      <img 
                        src={video.thumbnail}
                        alt={video.title}
                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                      />
                      <!-- Play Button Overlay -->
                      <div class="absolute inset-0 flex items-center justify-center bg-black/30 group-hover:bg-black/50 transition-all">
                        <svg 
                          class="w-20 h-20 text-white drop-shadow-2xl group-hover:scale-110 transition-transform" 
                          fill="currentColor" 
                          viewBox="0 0 24 24"
                        >
                          <path d="M8 5v14l11-7z"/>
                        </svg>
                      </div>
                    </a>
                  </figure>
                  
                  <!-- Video Info -->
                  <div class="p-5 flex flex-col flex-grow">
                    <h3 class="text-base font-bold mb-2 line-clamp-2 text-[#006DAE]">
                      {video.title}
                    </h3>
                    <p class="text-sm text-[#2B1F3D]/80 mb-4 line-clamp-2 italic flex-grow">
                      {video.description}
                    </p>
                    <div class="mt-auto">
                      <a 
                        href={`https://www.youtube.com/watch?v=${video.id}`}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="inline-block px-6 py-2 bg-white text-[#2B1F3D] rounded-full font-bold hover:bg-[#C76E90] hover:scale-105 transition-all shadow-md text-sm"
                      >
                        Watch on Youtube
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </section>
      )}

      <!-- About Section -->
      <section id="about" class="mb-16 bg-[#E8E35C] rounded-3xl p-8 md:p-12 shadow-xl">
        {about && (
          <div class="grid md:grid-cols-2 gap-8 items-start">
            
            <div class="w-full aspect-[3/4] relative overflow-hidden rounded-2xl border-4 border-[#2B1F3D] shadow-2xl">
              {about.profileImage && (
                <img 
                  src={`${strapiUrl}${about.profileImage.url}`}
                  alt="DJ Photo"
                  class="absolute inset-0 w-full h-full object-cover"
                />
              )}
            </div>

            <div class="space-y-4">
              <h2 class="text-4xl md:text-5xl font-black mb-8 text-[#2B1F3D]">
                about the dj
              </h2>
                <div class="text-[#2B1F3D] leading-relaxed">
                    <RichText content={about.bio} />
                </div>
            </div>
          </div>
        )}
      </section>
    </main>

    <!-- Footer Section -->
    <footer class="w-full bg-[#D77FA1] mt-5 pt-16 pb-12">
      <div class="container mx-auto px-6 max-w-6xl text-center">
        
        <section id="contact">
          <h2 class="text-4xl md:text-5xl font-black mb-8 text-white">
            let's keep in touch!
          </h2>

          {socialLinks.length > 0 && (
            <div class="flex justify-center gap-4 mb-10">
              {socialLinks.map((link: any) => (
                <a 
                  href={link.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center justify-center w-16 h-16 bg-[#2B1F3D] rounded-full hover:bg-[#3A2D4F] transition-all hover:scale-110 shadow-lg"
                  title={link.platform}
                >
                  <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <Fragment set:html={getIconSVG(link.icon)} />
                  </svg>
                </a>
              ))}
            </div>
          )}

          <h3 class="text-2xl md:text-3xl font-black text-[#006DAE] leading-tight opacity-90">
            hobby collector / music enjoyer / creative
          </h3>
        </section>

        <p class="mt-12 text-sm font-bold text-[#2B1F3D]/60">
          &copy; {new Date().getFullYear()} {settings?.siteName}.
        </p>
      </div>
    </footer>

    <style>
      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }

      h2, h3 {
        font-family: 'SpecialGothicExpandedOne', 'Inter', sans-serif;
      }
      
      p {
        font-family: 'BeVietnamPro', 'Inter', sans-serif;
      }
      
      html {
        scroll-behavior: smooth;
      }
    </style>
  </body>
</html>